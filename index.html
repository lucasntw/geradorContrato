<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Gerador de Contrato</title>
</head>

<body>

    <section id="firstBox">
        <div id="coluna1F">
            <div>
                <p>Razão Social</p>
                <input type="text" id="razaoSocial">
            </div>
            <div>
                <p>Rua</p>
                <input type="text" id="rua">
            </div>
            <div>
                <p>Cidade</p>
                <input type="text" id="cidade">
            </div>
            <div>
                <p>Bairro</p>
                <input type="text" id="bairro">
            </div>
            <div>
                <p>Representante Legal</p>
                <input type="text" id="representanteLegal">
            </div>
        </div>

        <div id="coluna2F">
            <div>
                <p>CNPJ</p>
                <input type="text" id="cnpj" maxlength="15" placeholder="00.000.000/0000-00">
            </div>
            <div style="display: flex; gap: 40px;">
                <div>
                    <p>Número</p>
                    <input type="text" id="numero" style="width: 90%"
                        onkeypress="return event.charCode >= 48 && event.charCode <= 57">
                </div>
                <div>
                    <p>Complemento</p>
                    <input type="text" id="complemento">
                </div>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <div>
                    <p>Estado</p>
                    <select id="estado" name="estado" style="width: 185%;">
                        <option value="">-</option>
                        <option value="AC">AC</option>
                        <option value="AL">AL</option>
                        <option value="AP">AP</option>
                        <option value="AM">AM</option>
                        <option value="BA">BA</option>
                        <option value="CE">CE</option>
                        <option value="DF">DF</option>
                        <option value="ES">ES</option>
                        <option value="GO">GO</option>
                        <option value="MA">MA</option>
                        <option value="MT">MT</option>
                        <option value="MS">MS</option>
                        <option value="MG">MG</option>
                        <option value="PA">PA</option>
                        <option value="PB">PB</option>
                        <option value="PR">PR</option>
                        <option value="PE">PE</option>
                        <option value="PI">PI</option>
                        <option value="RJ">RJ</option>
                        <option value="RN">RN</option>
                        <option value="RS">RS</option>
                        <option value="RO">RO</option>
                        <option value="RR">RR</option>
                        <option value="SC">SC</option>
                        <option value="SP">SP</option>
                        <option value="SE">SE</option>
                        <option value="TO">TO</option>
                        <option value="EX">EX</option>
                    </select>
                </div>
                <div>
                    <p>CEP</p>
                    <input type="text" id="cep" placeholder="00.000-000">
                </div>
            </div>
            <div>
                <p>CPF</p>
                <input type="text" id="cpf" placeholder="000.000.000-00">
            </div>
        </div>
    </section>

    <section id="secondBox" class="container">

        <div>
            <div style="padding-bottom: 30px;">
                <label for="nSocios">No. de Sócios:</label>
                <input type="text" id="nSocios" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
            </div>
            <div>
                <label for="nFuncionarios">No. de Funcionários:</label>
                <input type="text" id="nFuncionarios" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
            </div>
        </div>
        <div>
            <div style="padding-bottom: 30px;">
                <label for="nContas">No. de Contas:</label>
                <input type="text" id="nContas" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
            </div>
            <div>
                <label for="nNotasF">No. de Notas Fiscais:</label>
                <input type="text" id="nNotasF" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
            </div>
        </div>
        <div>
            <div style="padding-bottom: 10px;">
                <label for="faixaF">Faixa de Faturamento:</label>
                <select name="faixaF" id="faixaF">
                    <option value="">-</option>
                    <option value="opc1">Até 25,000,00</option>
                    <option value="opc2">De 25.000,01 até 50.000,00</option>
                    <option value="opc3">De 50.000,01 até 75.000,00</option>
                </select>
            </div>
            <div>
                <label for="enquadramento">Enquadramento:</label>
                <select name="faixaF" id="enquadramento">
                    <option value="">-</option>
                    <option value="MEI">MEI</option>
                    <option value="Simples Nacional">Simples Nacional</option>
                    <option value="Lucro Presumido">Lucro Presumido</option>
                </select>
            </div>
        </div>
    </section>

    <section id="thirdbox" class="container">
        <div >
            <form id="pacote" action="" style="text-align: right;">
                <p>Pacote Escolhido:</p>
                <div  >
                    <input type="radio" id="basico" name="pacote" value="basico">
                    <label for="basico">Básico</label>
                </div>
                <div>
                    <input type="radio" id="essencial" name="pacote" value="essencial">
                    <label for="essencial">Essencial</label>
                </div>
                <div>
                    <input type="radio" id="avancado" name="pacote" value="avancado">
                    <label for="avancado">Avançado</label>
                </div>
            </form>
        </div>
        <div>
            <div style="padding-bottom: 30px;">
                <label for="valorMensal">Valor Mensal: R$</label>
                <input type="text" id="valor" class="valorMask">
            </div>
            <div>
                <label for="vencimento">Primeiro Vencimento:</label>
                <input type="text" id="vencimento" class="data">
            </div>
        </div>
        <div>
            <div style="padding-bottom: 30px;">
                <label for="dataInicio">Data de Início Prest. Serviço:</label>
                <input type="text" id="dataInicio" class="data">
            </div>
            <div>
                <label for="dataContrato">Data Assinatura do Contrato:</label>
                <input type="text" id="dataContrato" class="data">
            </div>
        </div>
    </section>

    <br>

    <button id="btn" onclick="getInfo()">Enviar</button>
    <input type="file" id="doc" />

    <button onclick="generate()">Gerar Documento</button>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.34.0/docxtemplater.js"></script>
<script src="https://unpkg.com/pizzip@3.1.4/dist/pizzip.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
<script src="https://unpkg.com/pizzip@3.1.4/dist/pizzip-utils.js"></script>

<script src="https://code.jquery.com/jquery-3.6.3.js"></script>
<script src="script.js"></script>



<script>

    let name = ''
    let rua = ''
    let representanteLegal = ''
    let cidade = ''
    let bairro = ''
    let cnpj = ''
    let numero = ''
    let complemento = ''
    let complementoC = ''
    let estado = ''
    let cep = ''
    let cpf = ''
    let nSocios = ''
    let nContas = ''
    let nFuncionarios = ''
    let nNotasF = ''
    let faixaF = ''
    let faixaFop1 = ''
    let faixaFop2 = ''
    let faixaFop3 = ''
    let enquadramento = ''
    let formPacote = ''
    let pacoteOp1 = ''
    let pacoteOp2 = ''
    let pacoteOp3 = ''
    let valor = ''
    let valorExtenso = ''
    let valorNum = ''
    let parteInt = ''
    let parteDec = ''
    let vencimento = ''
    let dataInicio = ''
    let dataContrato = ''
    let dataContratoExtenso = ''


    function getInfo() {

        name = document.getElementById("razaoSocial").value
        rua = document.getElementById("rua").value
        representanteLegal = document.getElementById("representanteLegal").value
        cidade = document.getElementById("cidade").value
        bairro = document.getElementById("bairro").value
        cnpj = document.getElementById("cnpj").value
        numero = document.getElementById("numero").value
        complemento = document.getElementById("complemento").value
        estado = document.getElementById("estado").value
        cep = document.getElementById("cep").value
        cpf = document.getElementById("cpf").value
        nSocios = document.getElementById("nSocios").value
        nContas = document.getElementById("nContas").value
        nFuncionarios = document.getElementById("nFuncionarios").value
        nNotasF = document.getElementById("nNotasF").value
        enquadramento = document.getElementById("enquadramento").value
        vencimento = document.getElementById("vencimento").value
        dataInicio = document.getElementById("dataInicio").value
        valor = document.getElementById("valor").value
        dataContrato = document.getElementById("dataContrato").value
        faixaF = document.getElementById("faixaF").value                                                    
        formPacote = document.getElementById("pacote")
        const opPacote = formPacote.querySelector('input[name="pacote"]:checked').value
        dataContratoExtenso = dataMesExtenso(dataContrato)
        definirFaturamento(faixaF)
        definirPacote(opPacote)
        
        if (complemento == true){
            complementoC = ' - ' + complemento
        }
        valorNum = parseFloat(valor.replace(',','.'))
        parteInt = Math.floor(valorNum)
        parteDec = Math.round((valorNum - parteInt)*100) 
    
        if (parteDec == false){
            valorExtenso = parteInt.toString().extenso()
        }
        else{
            valorExtenso = parteInt.toString().extenso() + ' e ' + parteDec.toString().extenso()
        }
    }


    function definirFaturamento(faturamento) {
        if (faturamento == "opc1") {
            faixaFop1 = "x"
            faixaFop2 = "  "
            faixaFop3 = "  "
            return faixaFop1, faixaFop2, faixaFop3;
        }
        if (faturamento == "opc2") {
            faixaFop2 = "x"
            faixaFop3 = "  "
            faixaFop1 = "  "
            return faixaFop1, faixaFop2, faixaFop3;
        }
        if (faturamento == "opc3") {
            faixaFop3 = "x"
            faixaFop2 = "  "
            faixaFop1 = "  "
            return faixaFop1, faixaFop2, faixaFop3;
        }
    }

    function definirPacote(pacote) {
        if (pacote == "basico") {
            pacoteOp1 = "x"
            pacoteOp2 = "  "
            pacoteOp3 = "  "
            return pacoteOp1, pacoteOp2, pacoteOp3;
        }
        if (pacote == "essencial") {
            pacoteOp2 = "x"
            pacoteOp3 = "  "
            pacoteOp1 = "  "
            return pacoteOp1, pacoteOp2, pacoteOp3;
        }
        if (pacote == "avancado") {
            pacoteOp3 = "x"
            pacoteOp2 = "  "
            pacoteOp1 = "  "
            return pacoteOp1, pacoteOp2, pacoteOp3;
        }
    }

    var docs = document.getElementById("doc");
    function generate() {
        var reader = new FileReader();
        if (docs.files.length === 0) {
            alert("No files selected");
        }
        reader.readAsBinaryString(docs.files.item(0));

        reader.onerror = function (evt) {
            console.log("error reading file", evt);
            alert("error reading file" + evt);
        };
        reader.onload = function (evt) {
            const content = evt.target.result;
            var zip = new PizZip(content);
            var doc = new window.docxtemplater(zip, {
                paragraphLoop: true,
                linebreaks: true,
            });

            // Render the document (Replace {first_name} by John, {last_name} by Doe, ...)
            doc.render({
                RAZAOSOCIAL: name,
                REPRESENTANTE: representanteLegal,
                RUA: rua,
                CNPJ: cnpj,
                CIDADE: cidade,
                BAIRRO: bairro,
                CNPJ: cnpj,
                NUMERO: numero,
                COMPLEMENTO: complementoC,
                ESTADO: estado,
                CEP: cep,
                CPF: cpf,
                NSOCIOS: nSocios,
                NCONTAS: nContas,
                NFUNCIONARIOS: nFuncionarios,
                NNOTASF: nNotasF,
                ENQUADRAMENTO: enquadramento,
                VENCIMENTO: vencimento,
                DATAINICIO: dataInicio,
                DATACONTRATO: dataContratoExtenso,
                PACOTE1: pacoteOp1,
                PACOTE2: pacoteOp2,
                PACOTE3: pacoteOp3,
                VALOR: valor,
                VALOREXTENSO: valorExtenso,
                FAIXAF1: faixaFop1,
                FAIXAF2: faixaFop2,
                FAIXAF3: faixaFop3,


            });

            var blob = doc.getZip().generate({
                type: "blob",
                mimeType:
                    "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                // compression: DEFLATE adds a compression step.
                // For a 50MB output document, expect 500ms additional CPU time
                compression: "DEFLATE",
            });
            // Output the document using Data-URI
            saveAs(blob, "Contrato.docx");
        };
    }

    String.prototype.extenso = function (c) {
        var ex = [
            ["zero", "um", "dois", "três", "quatro", "cinco", "seis", "sete", "oito", "nove", "dez", "onze", "doze", "treze", "quatorze", "quinze", "dezesseis", "dezessete", "dezoito", "dezenove"],
            ["dez", "vinte", "trinta", "quarenta", "cinquenta", "sessenta", "setenta", "oitenta", "noventa"],
            ["cem", "cento", "duzentos", "trezentos", "quatrocentos", "quinhentos", "seiscentos", "setecentos", "oitocentos", "novecentos"],
            ["mil", "milhão", "bilhão", "trilhão", "quadrilhão", "quintilhão", "sextilhão", "setilhão", "octilhão", "nonilhão", "decilhão", "undecilhão", "dodecilhão", "tredecilhão", "quatrodecilhão", "quindecilhão", "sedecilhão", "septendecilhão", "octencilhão", "nonencilhão"]
        ];
        var a, n, v, i, n = this.replace(c ? /[^,\d]/g : /\D/g, "").split(","), e = " e ", $ = "real", d = "centavo", sl;
        for (var f = n.length - 1, l, j = -1, r = [], s = [], t = ""; ++j <= f; s = []) {
            j && (n[j] = (("." + n[j]) * 1).toFixed(2).slice(2));
            if (!(a = (v = n[j]).slice((l = v.length) % 3).match(/\d{3}/g), v = l % 3 ? [v.slice(0, l % 3)] : [], v = a ? v.concat(a) : v).length) continue;
            for (a = -1, l = v.length; ++a < l; t = "") {
                if (!(i = v[a] * 1)) continue;
                i % 100 < 20 && (t += ex[0][i % 100]) ||
                    i % 100 + 1 && (t += ex[1][(i % 100 / 10 >> 0) - 1] + (i % 10 ? e + ex[0][i % 10] : ""));
                s.push((i < 100 ? t : !(i % 100) ? ex[2][i == 100 ? 0 : i / 100 >> 0] : (ex[2][i / 100 >> 0] + e + t)) +
                    ((t = l - a - 2) > -1 ? " " + (i > 1 && t > 0 ? ex[3][t].replace("ão", "ões") : ex[3][t]) : ""));
            }
            a = ((sl = s.length) > 1 ? (a = s.pop(), s.join(" ") + e + a) : s.join("") || ((!j && (n[j + 1] * 1 > 0) || r.length) ? "" : ex[0][0]));
            a && r.push(a + (c ? (" " + (v.join("") * 1 > 1 ? j ? d + "s" : (/0{6,}$/.test(n[0]) ? "de " : "") + $.replace("l", "is") : j ? d : $)) : ""));
        }
        return r.join(e);
    }

    function dataMesExtenso(data) {
        const meses = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
        const partes = data.split('/');
        const dia = partes[0];
        const mes = meses[partes[1] - 1];
        const ano = partes[2];
        return dia + ' de ' + mes + ' de ' + ano;
    }
</script>


</html>